#!/usr/bin/env python3
from assembler import DEFAULT_INSTRUCTIONS_PATH, assemble, load_op_info

sources = [
# Memory instructions
('	MPY	â€”',     0b10100_000_00000000),
('	MPY	,X',    0b10100_100_00000000),
('	MPY	I',     0b10100_010_00000000),
('	MPY	,XI',   0b10100_110_00000000),
('	MPY	,B',    0b10100_001_00000000),
('	MPY	,X,B',  0b10100_101_00000000),
('	MPY	I,B',   0b10100_011_00000000),
('	MPY	,XI,B', 0b10100_111_00000000),
('	MPY	127',   0b10100_000_01111111),
('	MPY	1',     0b10100_000_00000001),
('	MPY	0',     0b10100_000_00000000),
('	MPY	-1',    0b10100_000_11111111),
('	MPY	-128',  0b10100_000_10000000),
('	MPY	1,XI',  0b10100_110_00000001),
('	MPY	23,XI', 0b10100_110_00010111),
('	MPY	-9,XI', 0b10100_110_11110111),
('	STZ 1',     0b00000_000_00000001),
('	STA 1',     0b00001_000_00000001),
('	STT 1',     0b00010_000_00000001),
('	STX 1',     0b00011_000_00000001),
('	MIN 1',     0b01000_000_00000001),
('	LDA 1',     0b01001_000_00000001),
('	LDT 1',     0b01000_000_00000001),
('	LDX 1',     0b01011_000_00000001),
('	ADD 1',     0b01100_000_00000001),
('	SUB 1',     0b01101_000_00000001),
('	AND 1',     0b01110_000_00000001),
('	ORA 1',     0b01111_000_00000001),
('	MPY 1',     0b10100_000_00000001),
# Argument instructions
('	SAA	-1',    0b11110_001_11111111),
('	SAA	-128',  0b11110_001_10000000),
('	SAA	1',     0b11110_001_00000001),
('	SAA	23',    0b11110_001_00010111),
('	SAA	-9',    0b11110_001_11110111),
('	AAA	1',     0b11110_101_00000001),
('	SAX	1',     0b11110_011_00000001),
('	AAX	1',     0b11110_111_00000001),
('	SAT	1',     0b11110_010_00000001),
('	AAT	1',     0b11110_110_00000001),
('	SAB	1',     0b11110_000_00000001),
('	AAB	1',     0b11110_100_00000001),
]


if __name__ == '__main__':
    op_info = load_op_info(DEFAULT_INSTRUCTIONS_PATH)
    for source, expected in sources:
        out = assemble(source, op_info)
        out_as_int = int.from_bytes(out, 'big')
        assert out_as_int == expected, f'{out_as_int:0{len(out)*8}b} != {expected:016b} for "{source}"'
    print('All tests passed!')
